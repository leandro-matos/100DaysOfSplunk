
### Principais funções do PowerUser
* Usuário avançado do Splunk com um elevado conhecimento na parte de administração do Splunk a nível de Usuário;
* As responsabilidades são fornecer informações aos usuários em toda a empresa e criar e gerenciar os objetos de conhecimento do Splunk para as partes interessadas;
* Implementar as melhores práticas para as convenções de nomenclatura de todos os objetos de conhecimento;
* Coletar dados e estatísticas e relatar sobre Segurança, Operações de TI, Inteligência Operacional, etc.


### Basic Search Review
* Keywords:
Por exemplo, pesquise uma única palavra (por exemplo, **error**) ou grupo de palavras (por exemplo, **error password**)

* Booleans:
**NOT, OR, AND**; AND está implícito; DEVE estar em letras maiúsculas; pode usar ()'s para forçar a precedência
Ex: **sourcetype = vendor_sales OR (sourcetype = access_combined action = purchase)**

* Phrases:
**"web error"** é diiferente de **web** AND **error**

* Field searches:
status=404,	user=admin

* Wildcard (*):
status=40* corresponde a 40, 40a, 404, etc.
Iniciar palavras-chave com um caractere curinga é muito ineficiente, por exemplo: *dmin, *assword, *ailure

* Comparisons:
=, !=, <, <=, >=, >	
status>399,	
user!=admin

* **table**: retorna a tabela contendo apenas campos especificados no conjunto de resultados
* **rename**: renomeia um campo nos resultados
* **fields**: inclui ou exclui campos especificados
* **dedup**: remove duplicados dos resultados
* **sort**: classifica os resultados por campo especificado
* **lookup**: adiciona valores de campo de fonte externa (por exemplo, arquivos .csv)


### Case-sensitive - Sensitive
* Operadores Booleanos (Maiúsculos): 
    * AND, OR, NOT (Operadores Booleanos) and, or, not (palavras-chave literais)

* Field names	
    * productId vs. productid
    * eval cs_username = "Total	Access"

* Field values from lookup (default, but configurable)	
    * product_name="Tulip Bouquet" vs. product_name="tulip bouquet"

* Expressões Regulares:	
    * \d\d\d vs. \D\D\D

* eval and where commands	
    * eval action=if(action=="view",...) where action="Purchase" stats count(eval(action="view") as…

* Tags 
    * tag=DMZ vs. tag=dmz

* Command names:
    * STATS, **stats**, sTaTs

* Command clauses:
    * AS used by stats,	rename,	...;
    * BY used by stats,	chart, top,	...; 
    * WITH used	by replace

* Search terms:
    * failed, FAILED, Failed

* Statistical functions:
    * **avg**, AVG,	Avg	used by	**stats**, **chart**, …

* Field values:
    * host=www1, host=WWW1 (A menos que venha de uma pesquisa)



### Como o Splunk faz pesquisas ? - Buckets
* Conforme os eventos chegam, o Splunk os coloca em um balde **hot** de índice (apenas gravavel);
* Conforme os baldes envelhecem, eles passam do **quente** para o **warm** e para o **cold**
* Cada intervalo tem seus próprios dados brutos, metadados e arquivos de índice
* Metadata files track source, sourcetype, and host
* Os administradores podem adicionar mais

### Como o Splunk faz pesquisas ? - Procurando
* Quando você pesquisa, o Splunk usa o intervalo de tempo para escolher quais buckets pesquisar e, em seguida, usa os índices de bucket para encontrar eventos de qualificação
* Quando você pesquisa por **index=web password fail *** durante as últimas 24 horas:
    - O Splunk identifica os baldes das últimas 24 horas;
    - E pesquisa os índices desses baldes para os termos de pesquisa;
    - Hot (Agora até 08 horas); Warm (09 até 48 horas); Cold: (48 até 57 horas, etc.)


### Práticas Gerais de Pesquisa
* Como os eventos são armazenados por hora, o tempo é o filtro mais eficiente;
* Depois de algum tempo, as palavras-chave mais poderosas são host, source, sourcetype;
* Para tornar as pesquisas mais eficientes, inclua o máximo de termos possível. Ex: Pesquisar por **sourcetype=x fail** é melhor do que **fail**
* Use o comando **fields** para extrair (descobrir) apenas os campos de que você precisa
* Exemplo: Pesquisa nos últimos 365 dias, verifica 566.720 eventos (em segundos):
    - **index=web sourcetype=access_combined** Pesquisa: 15.16 segundos
    - **index=web sourcetype=access_combined | fields clientip bytes referrer** Pesquisa: 4.49 segundos


### Práticas Gerais de Pesquisa - Wildcards
* O Splunk pesquisa apenas palavras inteiras, mas caracteres curinga são permitidos
* Apenas os curingas no final fazem uso eficiente do índex:
    - Caracteres curinga no início da sequência de varredura de todos os eventos dentro do prazo;
    - Os curingas no meio da string podem retornar resultados inconsistentes;
    - Portanto, use **fail*** (não *fail ou *fail* ou f*il)
* Caracteres curinga testados após todos os outros termos


### Práticas Gerais de Pesquisa
** A inclusão é geralmente melhor do que a exclusão
    - Pesquisar por **acesso negado** é mais rápido do que **NOT "acesso concedido"**
** Filtre o mais cedo possível em sua pesquisa
    - Remover duplicatas e depois classificar é mais rápido do que classificar e remover duplicatas



